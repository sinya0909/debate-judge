
# AI討論ジャッジ

## 概要

人間同士の討論をAIがリアルタイムで判定するチャットアプリ。

## コンセプト

- 討論のテーマ = チャットルーム
- 参加者が論を展開
- AIが論理の正当性をリアルタイム評価
- 終了条件を満たすと勝者判定

## 仕様

### 参加者

| フェーズ | 人数 |
|---------|------|
| プロトタイプ | 人間2人 |
| 最終形 | 複数人 |

### AI判定基準

1. **論理の正当性**
   - 論点からの逸脱
   - 論理の飛躍
   - 矛盾の有無
   - 根拠の妥当性

2. **勝敗判定**
   - スコアリング方式
   - 終了条件を満たした時点で勝敗確定

### 判定タイミング

- リアルタイム（各発言ごと）
- AIがJSON形式でスコアを返す
- スコアはUIに即時反映

### 討論終了条件（OR）

| 条件 | 設定値 | 備考 |
|------|--------|------|
| ポイント差 | 10pt（デフォルト） | 変更可能 |
| 時間制限 | 10分（デフォルト） | 変更可能 |
| コメント回数 | 各30回（デフォルト） | 変更可能 |

### スコア計算

- **加点**: 論理的な主張、根拠の提示、反論の成功
- **減点**: 論理破綻、矛盾、論点逸脱、人格攻撃

### AI応答フォーマット（想定）

```json
{
  "evaluation": {
    "logic_score": 2,
    "reasoning": "論点に対して具体的な根拠を提示",
    "issues": []
  },
  "scores": {
    "player1": 15,
    "player2": 8
  },
  "is_finished": false,
  "winner": null
}
```

## 技術スタック

- フロントエンド: React + TypeScript
- リアルタイム通信: Ably
- AI: OpenAI GPT-4o mini（コスト重視）
- ホスティング: Vercel
- API: Vercel Serverless Functions
- DB/認証: Supabase（PostgreSQL + Auth）

## 追加機能

### ユーザー認証

- Supabase Auth使用
- メール/パスワード or OAuth（Google等）
- ユーザープロフィール（表示名、戦績）

### ユーザー統計

- **勝率**: 勝利数 / 総討論数
- **討論傾向**:
  - 得意なテーマ
  - 平均スコア
  - よく使う論法（AIが分析）
  - 弱点（論理飛躍が多い、感情的になりやすい等）

### 討論終了後の総評

AIによる討論全体のレビュー：
- 勝敗の決め手となったポイント
- 各参加者の良かった点・改善点
- 討論全体の質の評価
- 次回への具体的アドバイス

```json
{
  "summary": {
    "winner": "player1",
    "decisive_moment": "第5発言での具体的データ提示が決定打",
    "debate_quality": 7,
    "player1_review": {
      "strengths": ["根拠の明確さ", "反論の的確さ"],
      "weaknesses": ["序盤の論点整理が不十分"],
      "advice": "最初に論点を明確に定義すると更に説得力が増す"
    },
    "player2_review": {
      "strengths": ["問題提起の鋭さ"],
      "weaknesses": ["感情的な表現が多い", "根拠不足"],
      "advice": "主張には必ず具体的なデータや事例を添える"
    }
  }
}
```

### 勝敗履歴

- 終了した討論ルームの一覧表示
- 各ルームの情報：
  - テーマ
  - 参加者
  - 勝者
  - 最終スコア
  - 終了日時
- フィルタ：自分が参加した討論のみ表示可能

### DBスキーマ（想定）

```sql
-- ユーザー（Supabase Authと連携）
users (
  id uuid primary key,
  display_name text,
  wins int default 0,
  losses int default 0,
  total_score int default 0,
  debate_count int default 0,
  tendency jsonb, -- AI分析による傾向データ
  created_at timestamp
)

-- 討論ルーム
debates (
  id uuid primary key,
  theme text,
  player1_id uuid references users,
  player2_id uuid references users,
  winner_id uuid references users,
  player1_score int,
  player2_score int,
  status text, -- 'waiting' | 'active' | 'finished'
  settings jsonb, -- 終了条件設定
  ai_summary jsonb, -- 終了後の総評
  created_at timestamp,
  finished_at timestamp
)

-- メッセージ履歴
messages (
  id uuid primary key,
  debate_id uuid references debates,
  user_id uuid references users,
  content text,
  ai_evaluation jsonb,
  created_at timestamp
)
```

## ロードマップ

### Week 1（12/16〜12/22）- プロトタイプ

| 日程 | タスク | 状態 |
|------|--------|------|
| 12/16 | 仕様確定 | 完了 |
| 12/17 | Supabase設定、認証実装 | - |
| 12/18 | ルーム作成・参加機能 | - |
| 12/19 | AI評価機能（Serverless Function） | - |
| 12/20 | スコアボード、終了判定 | - |
| 12/21 | AI総評、ユーザー統計 | - |
| 12/22 | 広告実装、テスト、デプロイ | - |

### Week 2以降（将来）

- バグ修正・改善
- 複数人対応
- プレミアムプラン検討
- マーケティング

## APIトークン

| サービス | 用途 | トークン |
|----------|------|----------|
| Ably | リアルタイム通信 | `r30FPw.jJww9Q:acIic6kXBc16MCapB5_AZGHjZIRYZN5WLAie4q7nluE` |
| Supabase | DB/認証 | 未取得 |
| OpenAI | AI判定 | 未取得 |
| 忍者AdMax | 広告 | 未取得 |

## プロトタイプ目標

**今週中に完成**（仕様確定: 2025-12-16）

### 最小構成

- [ ] ユーザー認証（Supabase Auth）
- [ ] 2人参加のチャットルーム
- [ ] 各発言に対するAI評価（JSON形式）
- [ ] スコア可視化（リアルタイム更新）
- [ ] 終了条件設定（ポイント差/時間/コメント数）
- [ ] 勝敗判定・表示
- [ ] AI総評（討論終了時）
- [ ] ユーザー統計（勝率・傾向）
- [ ] 勝敗履歴一覧

## 実装ステップ

1. プロジェクト作成（Next.js）
2. Supabase設定（Auth + DB）
3. ユーザー認証実装
4. ルーム作成・参加機能
5. Vercel Serverless FunctionでAI API呼び出し
6. 各発言後にAI評価を取得・表示
7. スコアボード実装
8. 終了条件判定・勝敗表示
9. AI総評生成・表示
10. ユーザー統計・傾向分析
11. 勝敗履歴一覧表示

## マネタイズ

### コスト構造

- OpenAI API: 発言ごと + 総評で課金発生
- Supabase: 無料枠内で収まる想定
- Vercel: 無料枠内で収まる想定
- Ably: 無料枠（1日10,000メッセージ）

### 収益化案

1. **広告表示**
   - ルーム参加時にインタースティシャル広告
   - 討論終了後の総評画面に広告
   - 履歴一覧にバナー広告

2. **プレミアムプラン（将来）**
   - 広告非表示
   - 詳細な傾向分析
   - 討論履歴の無制限保存

### 広告実装

- **忍者AdMax**（審査なし、即開始可能）
- 軌道に乗ったらGoogle AdSenseに移行検討
- 参加ボタン押下 → 広告表示 → ルーム入室

## 課題・検討事項

- AI APIコスト管理（1討論あたりの上限設定？）
- 評価の公平性・一貫性（プロンプト設計が重要）
- 広告収益 vs APIコストのバランス

## 関連

- Ably APIキー: Knowledge Graphに記録済み
